---
title: "Overinformativeness BDA"
output: html_notebook
---

# Set up environment

```{r}
library(tidyverse)
library(coda)
library(lme4)
library(gridExtra)
estimate_mode <- function(s) {
  d <- density(s)
  return(d$x[which.max(d$y)])
}
HPDhi<- function(s){
  m <- HPDinterval(mcmc(s))
  return(m["var1","upper"])
}
HPDlo<- function(s){
  m <- HPDinterval(mcmc(s))
  return(m["var1","lower"])
}
options("scipen"=10) 

source("./helper_scripts/model_helpers.R")
```

# Analyze color-size results

## Parameters

Read parameter data from BDA and compute MAPs and HDIs.
```{r}
params <- read_csv("../models/bdaOutput/colorSize_params.csv") %>%
  mutate(costDiff = colorCost - sizeCost) %>%
  mutate(typDiff = colorTyp - sizeTyp) %>%
  gather(parameter, value, alpha:typWeight, costDiff, typDiff)

params %>% 
  group_by(parameter) %>%
  summarize(mode = estimate_mode(value),
            md_lo = round(HPDlo(value), 3),
            md_hi = round(HPDhi(value), 3))
```

```{r}
numSamples = nrow(params)/length(unique(params$parameter))
params.samples <- params[rep(row.names(params), exp(params$outputProb)*numSamples), 3:4]

labels <- c(colorTyp = "color", sizeTyp = "size")
typParamPosteriors = ggplot(params.samples %>% filter(parameter %in% c('colorTyp', 'sizeTyp')), aes(x=value))+
    geom_histogram(aes(y=..density..),
                   data=subset(params.samples, parameter == "colorTyp"),
                   binwidth = .005, colour="black", fill="white") +
    geom_histogram(aes(y=..density..),
                 data =subset(params.samples, parameter == "sizeTyp" ),
                 binwidth = .005, colour="black", fill="white") +

    geom_density(aes(y=..density..),
                 data=subset(params.samples, parameter == "colorTyp"),
                 adjust = 2, alpha=.2, fill="#FF6666")+
    geom_density(aes(y=..density..),
                 data=subset(params.samples, parameter == "sizeTyp"),
                 adjust = 2, alpha=.2, fill="#FF6666")+
    # ggtitle("Param Posteriors (2000 samples; lag = 10; burnin=10000)") +
    facet_grid(parameter ~. , scales = 'free', labeller=labeller(parameter = labels)) +
    theme_bw() +
    xlim(.7, 1) +
  ylab("Density") +
  xlab("Semantic value")
typParamPosteriors
```

Clearly see that color semantic vaue is much greater than size (basically non-overlapping posteriors).


```{r}
labels <- c(colorCost = "color", sizeCost = "size")
costParamPosteriors = ggplot(params.samples %>% filter(parameter %in% c('colorCost', 'sizeCost')), aes(x=value))+
    geom_histogram(aes(y=..density..),
                   data=subset(params.samples, parameter == "colorCost"),
                   binwidth = .02, colour="black", fill="white") +
    geom_histogram(aes(y=..density..),
                 data =subset(params.samples, parameter == "sizeCost" ),
                 binwidth = .02, colour="black", fill="white") +

    geom_density(aes(y=..density..),
                 data=subset(params.samples, parameter == "colorCost"),
                 adjust = 1, alpha=.2, fill="#FF6666")+
    geom_density(aes(y=..density..),
                 data=subset(params.samples, parameter == "sizeCost"),
                 adjust = 1, alpha=.2, fill="#FF6666")+
    ylab("Density") +
  xlab("Cost") +

    # ggtitle("Param Posteriors (2000 samples; lag = 10; burnin=10000)") +
    facet_grid(parameter ~. , scales = 'free', labeller=labeller(parameter = labels)) +
    theme_bw() 
    #xlim(.5, 1)
costParamPosteriors
```

Stick together semantic value and cost plots for paper.
```{r}
pdf(file="../writing/pics/exp1-paramposteriors.pdf",height=3.5,width=8)
grid.arrange(typParamPosteriors,costParamPosteriors,nrow=1)
dev.off()
```

Inferred difference in color and size semantic value always above zero:
```{r}
answererParamPosteriors = ggplot(params.samples %>% filter(parameter %in% c('typDiff')), aes(x=value))+
    geom_histogram(data=subset(params.samples, parameter == "typDiff"),
                   binwidth = .003, colour="black", fill="white") +

    ggtitle("Param Posteriors (2000 samples; lag = 10; burnin=10000)") +
    facet_grid(parameter ~. , scales = 'free') +
    theme_bw() 
    #xlim(.5, 1)
answererParamPosteriors
```

Inferred difference in color and size cost around zero:
```{r}
answererParamPosteriors = ggplot(params.samples %>% filter(parameter %in% c('costDiff')), aes(x=value))+
    geom_histogram(data=subset(params.samples, parameter == "costDiff"),
                   binwidth = .05, colour="black", fill="white") +

    ggtitle("Param Posteriors (2000 samples; lag = 10; burnin=10000)") +
    facet_grid(parameter ~. , scales = 'free') +
    theme_bw() 
    #xlim(.5, 1)
answererParamPosteriors
```

## Predictives

Load empirical data and get into right format.

```{r}
emp = read.csv("../models/bdaInput/colorSize/bda_data.csv")
colnames(emp) = c("ID","Trial","Condition","Size","Color","OtherColor","Item","Utterance")
empirical = emp %>%
  mutate(CondLength = nchar(as.character(Condition))) %>%
  mutate(SufficientDimension = 
           case_when( CondLength == 7 ~ "color",
                      CondLength == 6 ~ "size",
                      TRUE ~ "error"),
         NumDistractors = as.numeric(as.character(str_sub(Condition,CondLength-1,CondLength-1))),
         NumSameDistractors = as.numeric(as.character(str_sub(Condition,CondLength,CondLength))),
         NumDiffDistractors = NumDistractors-NumSameDistractors,
         Variation = NumDiffDistractors/NumDistractors) %>%
  select(SufficientDimension,NumDistractors,Variation,Utterance) %>%
  mutate(Color = Utterance == "color",
         Size = Utterance == "size",
         Size_Color = Utterance == "size_color") %>%
  group_by(SufficientDimension,NumDistractors,Variation) %>%
  summarize(ProbColor = mean(Color),ProbSize = mean(Size),ProbSize_Color = mean(Size_Color),CILowC=ci.low(Color),CIHighC=ci.high(Color),CILowS=ci.low(Size),CIHighS=ci.high(Size),CILowSC=ci.low(Size_Color),CIHighSC=ci.high(Size_Color)) %>%
  ungroup() %>%
  mutate(YMinSize=ProbSize-CILowS,YMaxSize=ProbSize+CIHighS,YMinColor=ProbColor-CILowC,YMaxColor=ProbColor+CIHighC,YMinSize_Color=ProbSize_Color-CILowSC,YMaxSize_Color=ProbSize_Color+CIHighSC)

tmp_prob = empirical %>%
  select(SufficientDimension,NumDistractors,Variation,ProbColor,ProbSize,ProbSize_Color) %>%
  gather(Utterance, Probability,-SufficientDimension,-NumDistractors,-Variation) %>%
  mutate(Utterance=gsub("Prob","",as.character(Utterance)))

tmp_ymin = empirical %>%
  select(SufficientDimension,NumDistractors,Variation,YMinColor,YMinSize,YMinSize_Color) %>%
  gather(Utterance, YMin,-SufficientDimension,-NumDistractors,-Variation) %>%
  mutate(Utterance=gsub("YMin","",as.character(Utterance)))

tmp_ymax = empirical %>%
  select(SufficientDimension,NumDistractors,Variation,YMaxColor,YMaxSize,YMaxSize_Color) %>%
  gather(Utterance, YMax,-SufficientDimension,-NumDistractors,-Variation) %>%
  mutate(Utterance=gsub("YMax","",as.character(Utterance)))

empirical = tmp_prob %>%
  left_join(tmp_ymin,by=c("SufficientDimension","NumDistractors","Variation","Utterance")) %>%
  left_join(tmp_ymax,by=c("SufficientDimension","NumDistractors","Variation","Utterance")) %>%
  mutate(Utterance = tolower(Utterance),
         Data = "empirical")
```

Load predictives and get into right format.
```{r}
pred = read.csv("../models/bdaOutput/colorSize_predictives.csv",quote="")
colnames(pred)=c("Color","Size","Condition","OtherColor","Item","Utterance","Probability","Zero")
predictives = pred %>%
  mutate(CondLength = nchar(as.character(Condition))) %>%
  mutate(SufficientDimension = 
           case_when( CondLength == 7 ~ "color",
                      CondLength == 6 ~ "size",
                      TRUE ~ "error"),
         NumDistractors = as.numeric(as.character(str_sub(Condition,CondLength-1,CondLength-1))),
         NumSameDistractors = as.numeric(as.character(str_sub(Condition,CondLength,CondLength))),
         NumDiffDistractors = NumDistractors-NumSameDistractors,
         Variation = NumDiffDistractors/NumDistractors,
         Probability = exp(Probability)) %>%
  filter(Utterance %in% c("size","color","size_color")) %>%
  select(SufficientDimension,NumDistractors,Variation,Utterance,Probability) %>%
  mutate(Data = "model",
         YMin = NA,
         YMax = NA)
```

Bind empirical and predictives and plot (Fig 8 in paper).
```{r}
d = rbind(empirical,predictives)

ggplot(d, aes(x=Variation,y=Probability,color=Data)) +
  geom_errorbar(aes(ymin=YMin,ymax=YMax)) +
  geom_point(aes(shape=as.character(NumDistractors))) +
  xlab("Scene variation") +
  ylab("Utterance probability") +
  labs(shape="Number of\ndistractors") +
  facet_grid(SufficientDimension~Utterance)
ggsave("../writing/pics/exp1-empirical-predictives.pdf",height=3.5,width=6.7)
```


# Analyze color typicality results

## Parameters

Read parameter data from BDA and compute MAPs and HDIs.
```{r}
params <- read_csv("../models/bdaOutput/typicality_params.csv") %>%
  gather(parameter, value, alpha:typWeight)

params %>% 
  group_by(parameter) %>%
  summarize(mode = estimate_mode(value),
            md_lo = round(HPDlo(value), 3),
            md_hi = round(HPDhi(value), 3))
```

```{r}
numSamples = nrow(params)/length(unique(params$parameter))
params.samples <- params[rep(row.names(params), exp(params$outputProb)*numSamples), 3:4]

typParamPosteriors = ggplot(params.samples, aes(x=value))+
    geom_histogram(aes(y=..density..),
                   data=subset(params.samples, parameter == "alpha"),
                   binwidth = .1, colour="black", fill="white") +
    geom_histogram(aes(y=..density..),
                 data =subset(params.samples, parameter == "lengthCost" ),
                 binwidth = .1, colour="black", fill="white") +
      geom_histogram(aes(y=..density..),
                   data=subset(params.samples, parameter == "freqCost"),
                   binwidth = .1, colour="black", fill="white") +
    geom_histogram(aes(y=..density..),
                 data =subset(params.samples, parameter == "typWeight" ),
                 binwidth = .1, colour="black", fill="white") +

    geom_density(aes(y=..density..),
                 data=subset(params.samples, parameter == "alpha"),
                 adjust = 1, alpha=.2, fill="#FF6666")+
    geom_density(aes(y=..density..),
                 data=subset(params.samples, parameter == "lengthCost"),
                 adjust = 1, alpha=.2, fill="#FF6666")+
      geom_density(aes(y=..density..),
                 data=subset(params.samples, parameter == "freqCost"),
                 adjust = 1, alpha=.2, fill="#FF6666")+
    geom_density(aes(y=..density..),
                 data=subset(params.samples, parameter == "typWeight"),
                 adjust = 1, alpha=.2, fill="#FF6666")+
    # ggtitle("Param Posteriors (2000 samples; lag = 10; burnin=10000)") +
    facet_wrap( ~ parameter, scales = 'free',nrow=1) +
    theme_bw() +
  ylab("Density") 
typParamPosteriors
ggsave(file="../writing/pics/exp2-paramposteriors.pdf",width=10,height=3)
```



JD: CONTINUE HERE LOADING THE RIGHT EMPIRICAL AND PREDICTIVES DATA FOR EXP 2 (AND MERGE IN TYPICALITY VALUES)




# Analyze nominal choice results

## Parameters

Read parameter data from BDA and compute MAPs and HDIs.
```{r}
params <- read_csv("../models/bdaOutput/nominal_params.csv") %>%
  gather(parameter, value, alpha:typWeight)

params %>% 
  group_by(parameter) %>%
  summarize(mode = estimate_mode(value),
            md_lo = round(HPDlo(value), 3),
            md_hi = round(HPDhi(value), 3))
```

```{r}
numSamples = nrow(params)/length(unique(params$parameter))
params.samples <- params[rep(row.names(params), exp(params$outputProb)*numSamples), 3:4]
params.samples$parameter2 = factor(params.samples$parameter,labels = c("informativity","frequency","length","typicality"))
  
nomParamPosteriors = ggplot(params.samples, aes(x=value))+
    geom_histogram(aes(y=..density..),
                   data=subset(params.samples, parameter == "alpha"),
                   binwidth = .1, colour="black", fill="white") +
    geom_histogram(aes(y=..density..),
                 data =subset(params.samples, parameter == "lengthCost" ),
                 binwidth = .1, colour="black", fill="white") +
      geom_histogram(aes(y=..density..),
                   data=subset(params.samples, parameter == "freqCost"),
                   binwidth = .1, colour="black", fill="white") +
    geom_histogram(aes(y=..density..),
                 data =subset(params.samples, parameter == "typWeight" ),
                 binwidth = .1, colour="black", fill="white") +

    geom_density(aes(y=..density..),
                 data=subset(params.samples, parameter == "alpha"),
                 adjust = 1, alpha=.2, fill="#FF6666")+
    geom_density(aes(y=..density..),
                 data=subset(params.samples, parameter == "lengthCost"),
                 adjust = 1, alpha=.2, fill="#FF6666")+
      geom_density(aes(y=..density..),
                 data=subset(params.samples, parameter == "freqCost"),
                 adjust = 1, alpha=.2, fill="#FF6666")+
    geom_density(aes(y=..density..),
                 data=subset(params.samples, parameter == "typWeight"),
                 adjust = 1, alpha=.2, fill="#FF6666")+
    # ggtitle("Param Posteriors (2000 samples; lag = 10; burnin=10000)") +
    facet_wrap( ~ parameter2, scales = 'free',nrow=1) +
    theme_bw() +
  ylab("Density") 
nomParamPosteriors
ggsave(file="../writing/pics/exp3-paramposteriors.pdf",width=8,height=2)
```

## Predictives

Load empirical data and get into right format.

```{r}
emp = read.csv("../models/bdaInput/nominal/bda_data.csv")
colnames(emp) = c("Pair","Trial","Cond","Target","Dist1","Dist2","Utterance")

empirical = emp %>%
  mutate(Condition = 
           case_when(Cond == "basic12" ~ "sub necessary",
                     Cond == "basic33" ~ "super sufficient",
                     TRUE ~ "basic sufficient"),
         sub = Utterance == "sub",
         basic = Utterance == "basic",
         super = Utterance == "super") %>%
  group_by(Condition, Target) %>%
  summarize(ProbSub = mean(sub),ProbBasic = mean(basic),ProbSuper = mean(super),CILowSub=ci.low(sub),CIHighSub=ci.high(sub),CILowBasic=ci.low(basic),CIHighBasic=ci.high(basic),CILowSuper=ci.low(super),CIHighSuper=ci.high(super)) %>%
  ungroup() %>%
  mutate(YMinSub=ProbSub-CILowSub,YMaxSub=ProbSub+CIHighSub,YMinBasic=ProbBasic-CILowBasic,YMaxBasic=ProbBasic+CIHighBasic,YMinSuper=ProbSuper-CILowSuper,YMaxSuper=ProbSuper+CIHighSuper) 

tmp_prob = empirical %>%
  select(Condition,Target,ProbSub,ProbBasic,ProbSuper) %>%
  gather(Utterance, Probability, -Condition, -Target) %>%
  mutate(Utterance=gsub("Prob","",as.character(Utterance)))

tmp_ymin = empirical %>%
  select(Condition,Target,YMinSub,YMinBasic,YMinSuper) %>%
  gather(Utterance, YMin,-Condition,-Target) %>%
  mutate(Utterance=gsub("YMin","",as.character(Utterance)))

tmp_ymax = empirical %>%
  select(Condition,Target,YMaxSub,YMaxBasic,YMaxSuper) %>%
  gather(Utterance, YMax,-Condition,-Target) %>%
  mutate(Utterance=gsub("YMax","",as.character(Utterance)))

empirical = tmp_prob %>%
  left_join(tmp_ymin,by=c("Condition","Target","Utterance")) %>%
  left_join(tmp_ymax,by=c("Condition","Target","Utterance")) %>%
  mutate(Utterance = tolower(Utterance))
```

Load predictives and get into right format.
```{r}
pred = read.csv("../models/bdaOutput/nominal_predictives.csv",quote="")
colnames(pred)=c("Cond","Target","Dist1","Dist2","Utt","logProbability","Zero") 
predictives = pred %>%
    mutate(Condition = 
           case_when(Cond == "basic12" ~ "sub necessary",
                     Cond == "basic33" ~ "super sufficient",
                     TRUE ~ "basic sufficient"),
           Probability = exp(logProbability),
           Utterance = 
             case_when(Utt %in% c("vehicle","clothing","furniture","animal","snack","plant") ~ "super",
                       Utt %in% c("bear","bird","candy","car","dog","fish","flower","shirt","table") ~ "basic",
                       TRUE ~ "sub")) %>%
  select(Condition,Target,Utterance,Probability) %>%
  group_by(Condition,Target,Utterance) %>%
  summarize(ModelProb=mean(Probability),CILow=ci.low(Probability),CIHigh=ci.high(Probability)) %>%
  ungroup() %>%
  mutate(ModelYMin=ModelProb-CILow,ModelYMax=ModelProb+CIHigh) %>%
  select(-CILow,-CIHigh)
```

Bind empirical and predictives and plot (like Fig 8 in paper).
```{r}
d = left_join(empirical,predictives,by=c("Condition","Target","Utterance"))

ggplot(d, aes(x=ModelProb,y=Probability,color=relevel(as.factor(Utterance),"sub"))) +
  geom_errorbar(aes(ymin=YMin,ymax=YMax)) +
  geom_errorbarh(aes(xmin=ModelYMin,xmax=ModelYMax)) +
  geom_point() +
  xlab("Model predicted probability") +
  ylab("Empirical utterance proportion") +
  facet_wrap(~Condition) +
  # facet_wrap(~relevel(as.factor(Condition),"sub necessary")) +
  guides(color=guide_legend(title="Utterance"))
ggsave("../writing/pics/exp3-empirical-predictives.pdf",height=4,width=11)
```
Plot just model predictions. First add typicality values, then make same plot as Fig 19 but with model predictions instead of empirical
```{r}
typs = read.table("../data/typicality_exp3.csv",header=T,quote="",sep=",")
ttyps = droplevels(subset(typs, itemtype == "target"))
row.names(ttyps) = paste(ttyps$labeltype, ttyps$item)
d$typ_sub = ttyps[paste("sub",as.character(d$Target)),]$meanresponse
d$typ_basic = ttyps[paste("basic",as.character(d$Target)),]$meanresponse
d$typ_super = ttyps[paste("super",as.character(d$Target)),]$meanresponse

ggplot(d, aes(x=typ_sub,y=ModelProb,color=relevel(as.factor(Utterance),"sub"))) +
  geom_point() +
  geom_smooth(method="lm") +
  # geom_text(aes(label=item),nudge_y=.04) +
  ylab("Model predicted utterance probability") +
  xlab("Typicality of object for subordinate level utterance") +
  facet_wrap(~relevel(as.factor(Condition),"sub necessary")) +
  guides(color=guide_legend(title="Utterance"))
```








## Import predictives data XXX NOT UP TO DATE COLOR TYPICALITY BUSINESS

```{r}
colors <- c("yellow","orange","red","pink", "green","blue","brown","black")
types <- c('apple', 'avocado', 'banana', 'carrot', 'pear', 'tomato', 'pepper')
predictive<-read.csv("../models/typicality-predictives.csv") %>%
  rowwise() %>%
  mutate(target_item = paste0(c(as.character(t_color), as.character(t_item)), collapse = '_')) %>%
  filter(response %in% c(as.character(t_color), as.character(t_item), target_item)) %>%
  mutate(utterance = ifelse(as.character(response) %in% colors, 'color', 
                            ifelse(as.character(response) %in% types, 'item',
                                   'color_item'))) %>%
  group_by(condition, utterance, target_item) %>%
  summarize(modelProbability=mean(logModelProb)) 
```

## Plot predictives w/ empirical data

```{r}
combined <- left_join(agr, predictive)
answer_plots = (ggplot(combined, aes(x = modelProbability, y = Probability))
  + geom_errorbar(aes(ymax = YMax, ymin = YMin), alpha = .2) 
  + geom_point(aes(colour = condition))
  + geom_abline(intercept = 0, slope = 1, linetype = "dotted")
  + scale_x_continuous(lim = c(0,1), breaks=c(0,.5,1))
  + ggtitle("Answerer Posterior Predictive")
  #+ geom_smooth(method = "lm")
  + xlab("Model predicted probability")
  + ylim(0,1)
  + facet_wrap(~ utterance)
  #+ geom_text(aes(label=utterance), size = 2)
  + ylab("Empirical Probability")
  + theme_bw()   
  + theme(text = element_text(size = 10),  axis.text.x = element_text(angle=90, vjust=1), aspect.ratio = 1)
)
answer_plots
#dev.off()
```

Look at R^2

```{r}
summary(lm(Probability ~ modelProbability, data = combined))
```







# Analyze typicality results

### Load in model results

```{r}
params <- read_csv("../models/typicality-params.csv")
```

look at MAP, credible intervals...

```{r}
params %>% 
  group_by(parameter) %>%
  summarize(mode = estimate_mode(value),
            md_lo = round(HPDlo(value), 3),
            md_hi = round(HPDhi(value), 3))
```

```{r}
numSamples = nrow(params)/length(levels(params$parameter))
params.samples <- params[rep(row.names(params), exp(params$MCMCprob)*numSamples), 1:2]

#pdf(file="../writing/2016/journal-manuscript/figures/AnswererParamPosteriors.pdf",
        #width = 6, height = 3)
answererParamPosteriors = ggplot(params.samples, aes(x=value))+
  #geom_histogram(aes(y=..density..)) +
  
    geom_histogram(aes(y=..density..),
                   data =subset(params.samples, parameter == "alpha" ),
                   binwidth = .5, colour="black", fill="white") +
    geom_histogram(aes(y=..density..),
                   data=subset(params.samples, parameter == "typWeight"),
                   binwidth = .25, colour="black", fill="white") +
    geom_histogram(aes(y=..density..),
                 data =subset(params.samples, parameter == "cost_color" ),
                 binwidth = .5, colour="black", fill="white") +
    geom_histogram(aes(y=..density..),
                 data=subset(params.samples, parameter == "cost_type"),
                 binwidth = .25, colour="black", fill="white") +

    geom_density(aes(y=..density..),
                 data =subset(params.samples, parameter == "alpha" ),
                 adjust = 1, alpha=.2, fill="#FF6666")+
    geom_density(aes(y=..density..),
                 data=subset(params.samples, parameter == "typWeight"),
                 adjust = 5, alpha=.2, fill="#FF6666")+
    geom_density(aes(y=..density..),
                 data=subset(params.samples, parameter == "cost_color"),
                 adjust = 5, alpha=.2, fill="#FF6666")+
    geom_density(aes(y=..density..),
                 data=subset(params.samples, parameter == "cost_type"),
                 adjust = 5, alpha=.2, fill="#FF6666")+

    ggtitle("Parameter Posteriors (500 iterations)") +
    facet_grid(~parameter, scales = 'free') +
    theme_bw()
answererParamPosteriors
```

Looks like there's a super narrow range where the pragmatic model makes much much better predictions... 

### Predictives

# Import empirical data

```{r}
empirical = read.csv("../models/bdaInput/typicality/bda_data-raw.csv") %>%
  mutate(target_item = paste(t_color, t_item, sep = "_")) %>%
  mutate(color = ifelse(as.character(response) == as.character(t_color),1,0)) %>%
  mutate(item = ifelse(as.character(response) == as.character(t_item),1,0)) %>%
  mutate(color_item = ifelse(as.character(response) == as.character(target_item),1,0))

agr = empirical %>%
  select(color,item,color_item,condition,target_item) %>%
  gather(utterance,mentioned,-condition,-target_item) %>%
  group_by(condition,utterance,target_item) %>%
  summarise(Probability=mean(mentioned),
            cilow=ci.low(mentioned),
            cihigh=ci.high(mentioned)) %>%
  ungroup() %>%
  mutate(YMax = Probability + cihigh) %>%
  mutate(YMin = Probability - cilow) %>%
  select(condition, target_item, utterance, Probability, YMax, YMin)
agr = as.data.frame(agr)
```

## Import predictives data

```{r}
colors <- c("yellow","orange","red","pink", "green","blue","brown","black")
types <- c('apple', 'avocado', 'banana', 'carrot', 'pear', 'tomato', 'pepper')
predictive<-read.csv("../models/typicality-predictives.csv") %>%
  rowwise() %>%
  mutate(target_item = paste0(c(as.character(t_color), as.character(t_item)), collapse = '_')) %>%
  filter(response %in% c(as.character(t_color), as.character(t_item), target_item)) %>%
  mutate(utterance = ifelse(as.character(response) %in% colors, 'color', 
                            ifelse(as.character(response) %in% types, 'item',
                                   'color_item'))) %>%
  group_by(condition, utterance, target_item) %>%
  summarize(modelProbability=mean(logModelProb)) 
```

## Plot predictives w/ empirical data

```{r}
combined <- left_join(agr, predictive)
answer_plots = (ggplot(combined, aes(x = modelProbability, y = Probability))
  + geom_errorbar(aes(ymax = YMax, ymin = YMin), alpha = .2) 
  + geom_point(aes(colour = condition))
  + geom_abline(intercept = 0, slope = 1, linetype = "dotted")
  + scale_x_continuous(lim = c(0,1), breaks=c(0,.5,1))
  + ggtitle("Answerer Posterior Predictive")
  #+ geom_smooth(method = "lm")
  + xlab("Model predicted probability")
  + ylim(0,1)
  + facet_wrap(~ utterance)
  #+ geom_text(aes(label=utterance), size = 2)
  + ylab("Empirical Probability")
  + theme_bw()   
  + theme(text = element_text(size = 10),  axis.text.x = element_text(angle=90, vjust=1), aspect.ratio = 1)
)
answer_plots
#dev.off()
```

Look at R^2

```{r}
summary(lm(Probability ~ modelProbability, data = combined))
```

Plot qualitative pattern

```{r}
typ = read.csv(file="~/cogsci/projects/stanford/projects/overinformativeness/experiments/elisa_paper_relevant/norming_comp_object/results/data/meantypicalities.csv")
typ = typ[as.character(typ$Item) == as.character(typ$utterance),]
row.names(typ) = paste(typ$Color,typ$Item,sep="_")
combined$NounTypicality = typ[as.character(combined$target_item),]$MeanTypicality

ggplot(combined, aes(x=NounTypicality,y=modelProbability,color=Utterance)) +
  geom_point() +
  geom_smooth(method="lm") +
  facet_wrap(~conditionName)
```


Compare predictives with & without emperical lengths/weights

```{r}
predictiveComparison <-read_csv("./MAPneglCostPredictives.csv") %>%
  rename(empCostProb = prob) %>%
  left_join(read_csv("./MAPfixedcostPredictives.csv")) %>%
  rename(fixedCostProb = prob) %>%
  rowwise() %>%
  mutate(target_item = paste0(c(TargetColor, TargetType), collapse = '_')) %>%
  filter(value %in% c(TargetColor, TargetType, target_item)) %>%
  mutate(Utterance = ifelse(value %in% colors, 'color', 
                            ifelse(value %in% types, 'type',
                                   'color_type'))) %>%
  rename(conditionName = condition) %>%
  group_by(conditionName, Utterance, target_item) %>%
  summarize(empProb=mean(empCostProb), nonEmpProb = mean(fixedCostProb)) 

ggplot(predictiveComparison, aes(x = empProb, y = nonEmpProb)) +
  geom_point() +
  geom_text(aes(label=Utterance), size = 2)
```